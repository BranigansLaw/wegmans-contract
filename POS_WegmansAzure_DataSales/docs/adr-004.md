# ADR-003: Vnet for ACL issue

## Status
- Accepted (2021-10-20) @ 12:00pm

## Members who attended :
- [x] Michael Zobel (Dev POS)
- [x] Brian Mattern (Dev POS)
- [x] Karen Morano (Dev POS)
- [x] Jagreet Atwal (Toshiba)
- [x] Mike Wolford (EA)
- [x] Adam Weigert (EA)
- [x] Steve Kieffer (NCS Network)
- [x] Ken Cooper (NCS Network)
- [x] Josh Johnson (IT Security)

## Context
---
Two Network configurations at our Stores:

1. Vlan 4 (POS Network) behind Routers.
    * Router ACL can only allow traffic based on source IP, destination IP, source port, and destination port.  
2. Vlan 4 (POS Network) behind Palo 820s firewall.
    * Palo 820s allow URL filtering for OAuth endpoint and Storage endpoint. 

Azure Storage and Azure Active Directory has dozens of IP addresses that would need to be allowed via ACL.

Opening of POS network to Azure Storage and Azure AD would not be preferred.


## Decision
---

1. Creation of Vnet for Azure Storage. This gives us a dedicated IP for ACL store environment. 

2. POS Controllers to allow AUTH from Oauth (Preferred  method - Palo Stores) `OR` Access Keys (Compromise - Router ACLs).

3. Once NCS Network completes migration of Vlan 4 behind firewall Dev POS will remove logic for Access Keys. 

## Consequences
---
* Vnet is within Wegmans internal network through express route. `IF` express route has issues messages will queue on the controllers until problem is resolved. 